<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Music Player</title>
  <link href="https://fonts.googleapis.com/css2?family=Rancho&family=Poppins:wght@400;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    body {
      min-height: 100vh;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #191724, #283046, #1f2937 70%);
      color: #f4f1fb;
      position: relative;
      overflow: hidden;
    }
    svg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 0;
      filter: blur(8px);
      opacity: 0.5;
    }
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .out-top {
      animation: rotate 30s linear infinite;
      transform-origin: 13px 25px;
      fill: #6ee7b7;
    }
    .in-top {
      animation: rotate 15s linear infinite;
      transform-origin: 13px 25px;
      fill: #a78bfa;
    }
    .out-bottom {
      animation: rotate 35s linear infinite;
      transform-origin: 84px 93px;
      fill: #f472b6;
    }
    .in-bottom {
      animation: rotate 20s linear infinite;
      transform-origin: 84px 93px;
      fill: #fbbf24;
    }
    .note {
      position: absolute;
      font-size: 2.4rem;
      background: linear-gradient(135deg, #f472b6, #6ee7b7, #fbbf24);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      opacity: 0.8;
      animation: floatNotes 10s ease-in-out infinite;
      pointer-events: none;
      z-index: 1;
      filter: drop-shadow(0 2px 8px #19172466);
    }
    .note1 { left: 15%; top: 75%; animation-delay: 0s; font-size: 2.6rem; }
    .note2 { left: 85%; top: 85%; animation-delay: 2.5s; font-size: 2.2rem; }
    .note4 { left: 25%; top: 90%; animation-delay: 1.2s; font-size: 2.4rem; }
    .note5 { left: 75%; top: 80%; animation-delay: 3.8s; font-size: 2.1rem; }
    @keyframes floatNotes {
      0% { transform: translateY(0) scale(1) rotate(-12deg); opacity: 0.8; }
      50% { transform: translateY(-150px) translateX(15px) scale(1.15) rotate(10deg); opacity: 0.65; }
      80% { transform: translateY(-250px) translateX(-5px) scale(1.3) rotate(12deg); opacity: 0.4; }
      100% { transform: translateY(-300px) translateX(0px) scale(1.4) rotate(20deg); opacity: 0; }
    }
    .music-player {
      background: rgba(40, 48, 70, 0.85);
      border-radius: 32px;
      padding: 40px 32px;
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.5), inset 0 0 16px rgba(255, 255, 255, 0.10);
      backdrop-filter: blur(24px);
      border: 1.5px solid rgba(255, 255, 255, 0.18);
      width: 400px;
      text-align: center;
      position: relative;
      z-index: 10;
      overflow: hidden;
      transition: transform 0.3s cubic-bezier(.4,2,.6,1), box-shadow 0.3s;
    }
    .music-player:hover {
      transform: translateY(-7px) scale(1.02);
      box-shadow: 0 20px 64px rgba(0,0,0,0.6), 0 0 32px #a78bfa33;
    }
    .song-info h2 {
      font-family: 'Rancho', cursive;
      font-size: 1.6rem;
      color: #a78bfa;
      margin-bottom: 8px;
      min-height: 32px;
      letter-spacing: 1.2px;
      text-shadow: 0 2px 12px #191724cc;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      animation: scroll-left 10s linear infinite;
    }
    @keyframes scroll-left {
      0% { text-indent: 0; }
      100% { text-indent: -100%; }
    }
    .song-info p {
      font-size: 1rem;
      color: #fbbf24;
      min-height: 20px;
      margin-bottom: 20px;
      letter-spacing: 0.6px;
      opacity: 0.92;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      animation: scroll-right 12s linear infinite;
    }
    @keyframes scroll-right {
      0% { text-indent: 100%; }
      100% { text-indent: 0; }
    }
    .visualizer-row {
      width: 100%;
      height: 48px;
      margin: 40px auto 12px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      gap: 3px;
      pointer-events: none;
      user-select: none;
    }
    .bar {
      width: 8px;
      background: linear-gradient(180deg, #e66c35, #d04345, #85a752, #067dcc);
      border-radius: 4px;
      opacity: 0.92;
      transition: height 0.08s;
    }
    .player-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin: 24px 0;
    }
    .control-button {
      background: linear-gradient(135deg, #6ee7b7 30%, #f472b6 100%);
      border: none;
      color: #fff;
      font-size: 1.7rem;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 6px 18px #a78bfa55;
      transition: all 0.3s cubic-bezier(.4,2,.6,1);
      display: flex;
      align-items: center;
      justify-content: center;
      outline: none;
      position: relative;
      z-index: 2;
    }
    .control-button:hover {
      background: linear-gradient(135deg, #f472b6 30%, #6ee7b7 100%);
      transform: scale(1.13) rotate(5deg);
      box-shadow: 0 10px 32px #fbbf2440;
    }
    .stream-status {
      margin-top:14px;
      font-size:0.95rem;
      color:#bbb;
    }
    #offline {
      color: #fa225b;
      font-size: 1.1em;
      margin-top: 10px;
      display: none;
    }
    @media (max-width: 500px) {
      .music-player { width: 97vw; padding: 18px; }
      .visualizer-row { height: 24px; }
      .control-button { width: 48px; height: 48px; font-size: 1.3rem; }
    }
  </style>
</head>
<body>
  <!-- Animated Aurora SVG Background -->
  <svg preserveAspectRatio="xMidYMid slice" viewBox="10 10 80 80">
    <path fill="#ff9aa2" class="out-top" d="M37-5C25.1-14.7,5.7-19.1-9.2-10-28.5,1.8-32.7,31.1-19.8,49c15.5,21.5,52.6,22,67.2,2.3C59.4,35,53.7,8.5,37-5Z"/>
    <path fill="#b3cffa" class="in-top" d="M20.6,4.1C11.6,1.5-1.9,2.5-8,11.2-16.3,23.1-8.2,45.6,7.4,50S42.1,38.9,41,24.5C40.2,14.1,29.4,6.6,20.6,4.1Z"/>
    <path fill="#a3e4d7" class="out-bottom" d="M105.9,48.6c-12.4-8.2-29.3-4.8-39.4.8-23.4,12.8-37.7,51.9-19.1,74.1s63.9,15.3,76-5.6c7.6-13.3,1.8-31.1-2.3-43.8C117.6,63.3,114.7,54.3,105.9,48.6Z"/>
    <path fill="#a18cd1" class="in-bottom" d="M102,67.1c-9.6-6.1-22-3.1-29.5,2-15.4,10.7-19.6,37.5-7.6,47.8s35.9,3.9,44.5-12.5C115.5,92.6,113.9,74.6,102,67.1Z"/>
  </svg>
  <!-- Floating Notes -->
  <div class="note note1">ðŸŽµ</div>
  <div class="note note2">ðŸŽ¶</div>
  <div class="note note4">ðŸŽ¶</div>
  <div class="note note5">ðŸŽµ</div>

  <div class="music-player">
    <div class="song-info">
      <h2 id="song-title">Loading current track...</h2>
      <p id="artist-name"></p>
    </div>
    <div class="visualizer-row" id="visualizer"></div>
    <audio id="audio" src="https://listen.ramashamedia.com:8330/stream" crossorigin="anonymous"></audio>
    <div class="player-controls">
      <button class="control-button" id="rewind" title="Rewind 10s"><i class="fa-solid fa-backward"></i></button>
      <button class="control-button" id="play" title="Play"><i class="fa-solid fa-play"></i></button>
      <button class="control-button" id="stop" title="Stop"><i class="fa-solid fa-square"></i></button>
    </div>
    <div class="stream-status"><span id="stream-status">Stopped</span></div>
    <div id="offline">Radio is offline</div>
  </div>
  <script>
    // --- Elements ---
    const audio = document.getElementById('audio');
    const playBtn = document.getElementById('play');
    const stopBtn = document.getElementById('stop');
    const rewindBtn = document.getElementById('rewind');
    const songTitleElement = document.getElementById('song-title');
    const artistNameElement = document.getElementById('artist-name');
    const streamStatus = document.getElementById('stream-status');
    const offlineDiv = document.getElementById('offline');
    const visualizer = document.getElementById('visualizer');

    // --- Visualizer setup ---
    const barCount = 32;
    let bars = [];
    for(let i=0; i<barCount; i++) {
      const bar = document.createElement('div');
      bar.className = 'bar';
      bar.style.height = '12px';
      visualizer.appendChild(bar);
      bars.push(bar);
    }

    // --- Stream Play/Stop Logic ---
    let isPlaying = false;
    playBtn.addEventListener('click', () => {
      if (!isPlaying) {
        audio.src = "https://listen.ramashamedia.com:8330/stream";
        audio.load();
        audio.play().catch(err => {
          offlineDiv.style.display = "block";
          streamStatus.textContent = "Offline";
        });
        isPlaying = true;
        playBtn.innerHTML = '<i class="fa-solid fa-pause"></i>';
        streamStatus.textContent = 'Playing';
        offlineDiv.style.display = "none";
      } else {
        audio.pause();
        isPlaying = false;
        playBtn.innerHTML = '<i class="fa-solid fa-play"></i>';
        streamStatus.textContent = 'Paused';
      }
    });

    stopBtn.addEventListener('click', () => {
      audio.pause();
      audio.currentTime = 0;
      audio.src = ""; // Unload stream for true stop
      isPlaying = false;
      playBtn.innerHTML = '<i class="fa-solid fa-play"></i>';
      streamStatus.textContent = 'Stopped';
    });

    // Rewind (seek back 10s if possible, else restart)
    rewindBtn.addEventListener('click', () => {
      if (audio.currentTime > 10) {
        audio.currentTime -= 10;
      } else {
        audio.currentTime = 0;
      }
    });

    // --- Fetch & Display Song Title ---
    async function updateSongInfo() {
      try {
        // Use a CORS proxy for Shoutcast song info
        const proxyUrl = 'https://corsproxy.io/?';
        const targetUrl = encodeURIComponent('https://listen.ramashamedia.com:8330/currentsong?sid=1');
        const response = await fetch(proxyUrl + targetUrl);
        const songTitle = await response.text();
        let artist = 'Ramasha Media';
        let title = songTitle.trim();
        if (title && title.includes(' - ')) {
          [artist, title] = title.split(' - ', 2);
        }
        songTitleElement.textContent = title || 'No track information';
        artistNameElement.textContent = artist;
      } catch (error) {
        songTitleElement.textContent = 'No track information';
        artistNameElement.textContent = 'Ramasha Media';
      }
    }
    updateSongInfo();
    setInterval(updateSongInfo, 10000);

    // --- Audio Visualizer ---
    let ctx, analyser, source, freqData;
    function setupVisualizer() {
      if (!window.AudioContext) return;
      ctx = new (window.AudioContext || window.webkitAudioContext)();
      analyser = ctx.createAnalyser();
      source = ctx.createMediaElementSource(audio);
      source.connect(analyser);
      analyser.connect(ctx.destination);
      analyser.fftSize = 64;
      freqData = new Uint8Array(analyser.frequencyBinCount);

      function draw() {
        requestAnimationFrame(draw);
        if (!isPlaying) return;
        analyser.getByteFrequencyData(freqData);
        for (let i = 0; i < barCount; i++) {
          let h = Math.max(12, freqData[i] / 2.2);
          bars[i].style.height = h + "px";
        }
      }
      draw();
    }
    audio.addEventListener('play', setupVisualizer, { once: true });

    // --- Offline/Ended Handling ---
    audio.addEventListener('ended', () => {
      isPlaying = false;
      playBtn.innerHTML = '<i class="fa-solid fa-play"></i>';
      streamStatus.textContent = 'Stopped';
    });
    audio.addEventListener('pause', () => {
      if (!audio.src) {
        isPlaying = false;
        playBtn.innerHTML = '<i class="fa-solid fa-play"></i>';
        streamStatus.textContent = 'Stopped';
      }
    });
    audio.onerror = function() {
      offlineDiv.style.display = "block";
      streamStatus.textContent = "Offline";
    };
  </script>
</body>
</html>
